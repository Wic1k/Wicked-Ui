<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ö—Ä–æ–ª–∏–∫–∏ ‚Äî –∑–∞–∂–∏–º–∞–π –∏ —Å–º–æ—Ç—Ä–∏ –∫–∞–∫ –≤–∞–ª—è—Ç—Å—è</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #0a0015, #1a0033);
    font-family: system-ui, sans-serif;
    touch-action: none;
  }
  canvas {
    position: absolute;
    top: 0; left: 0;
  }
  #ui {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(8px);
    padding: 12px 18px;
    border-radius: 12px;
    color: #0ff;
    z-index: 100;
    pointer-events: none;
    user-select: none;
  }
  #counter {
    font-size: 2.8rem;
    font-weight: 900;
    color: #ffeb3b;
    text-shadow: 0 0 10px #ffeb3b66;
  }
  #fps {
    font-size: 1.4rem;
    opacity: 0.9;
  }
</style>
</head>
<body>

<div id="ui">
  <div>–ö–†–û–õ–ò–ö–û–í: <span id="counter">0</span></div>
  <div>FPS: <span id="fps">‚Äî</span></div>
  <div style="font-size:0.9rem; opacity:0.7; margin-top:6px;">
    –ó–∞–∂–º–∏ –∞ —Ç–æ –∫—Ä–æ–ª–∏–∫–∏ —Ö—É–π
  </div>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const counterEl = document.getElementById('counter');
const fpsEl = document.getElementById('fps');

let w, h;
let rabbits = [];
let isPressed = false;
let lastTime = 0;
let frameCount = 0;
let fps = 0;

function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}

class Rabbit {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.vx = (Math.random() - 0.5) * 5;
    this.vy = -8 - Math.random() * 12; // –≤–≤–µ—Ä—Ö –ø—Ä–∏ —Å–ø–∞–≤–Ω–µ
    this.gravity = 0.65;
    this.size = 22 + Math.random() * 10;
    this.rotation = Math.random() * Math.PI * 2;
    this.rotSpeed = (Math.random() - 0.5) * 0.25;
    this.onGround = false;
  }

  update() {
    if (this.onGround) {
      this.vy = 0;
      this.vx *= 0.92; // —Ç—Ä–µ–Ω–∏–µ
      if (Math.abs(this.vx) < 0.1) this.vx = 0;
      return;
    }

    this.vy += this.gravity;
    this.x += this.vx;
    this.y += this.vy;
    this.rotation += this.rotSpeed;

    // –ü–æ–ª
    if (this.y > h - this.size * 0.6) {
      this.y = h - this.size * 0.6;
      this.vy = -this.vy * 0.38; // –æ—Ç—Å–∫–æ–∫ –≤–≤–µ—Ä—Ö —Å–ª–∞–±—ã–π
      this.vx *= 0.8;

      if (Math.abs(this.vy) < 2) {
        this.onGround = true;
        this.vy = 0;
      }
    }

    // –°—Ç–µ–Ω—ã (—á—Ç–æ–±—ã –Ω–µ —É–±–µ–≥–∞–ª–∏)
    if (this.x < 0 || this.x > w) this.vx *= -0.7;
  }

  draw() {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);

    // —Ç–µ–Ω—å –ø–æ–¥ –∫—Ä–æ–ª–∏–∫–æ–º
    if (!this.onGround) {
      ctx.fillStyle = 'rgba(0,0,0,0.4)';
      ctx.beginPath();
      ctx.ellipse(0, 20, this.size * 0.9, 8, 0, 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.font = this.size + 'px Arial';
    ctx.fillStyle = '#fff';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('üê∞', 0, 0);

    ctx.restore();
  }
}

function spawnAt(x, y, count = 6) {
  for (let i = 0; i < count; i++) {
    let offsetX = (Math.random() - 0.5) * 60;
    let offsetY = (Math.random() - 0.5) * 40;
    rabbits.push(new Rabbit(x + offsetX, y + offsetY));
  }
  counterEl.textContent = rabbits.length;
}

function loop(time = 0) {
  const delta = time - lastTime;
  lastTime = time;

  frameCount++;
  if (frameCount % 10 === 0) {
    fps = Math.round(1000 / delta);
    fpsEl.textContent = fps;
  }

  // –º—è–≥–∫–∏–π —Ç—Ä–µ–π–ª
  ctx.fillStyle = 'rgba(10,0,20,0.08)';
  ctx.fillRect(0, 0, w, h);

  rabbits.forEach(r => {
    r.update();
    r.draw();
  });

  requestAnimationFrame(loop);
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∂–∞—Ç–∏–µ–º
function handleStart(e) {
  e.preventDefault();
  isPressed = true;

  const touch = e.touches ? e.touches[0] : e;
  spawnAt(touch.clientX, touch.clientY, 8);
}

function handleMove(e) {
  e.preventDefault();
  if (!isPressed) return;

  const touch = e.touches ? e.touches[0] : e;
  spawnAt(touch.clientX, touch.clientY, 5); // –º–µ–Ω—å—à–µ, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å —Å—Ä–∞–∑—É
}

function handleEnd() {
  isPressed = false;
}

// –°–æ–±—ã—Ç–∏—è
canvas.addEventListener('mousedown', handleStart);
canvas.addEventListener('mousemove', handleMove);
canvas.addEventListener('mouseup', handleEnd);
canvas.addEventListener('mouseleave', handleEnd);

canvas.addEventListener('touchstart', handleStart);
canvas.addEventListener('touchmove', handleMove);
canvas.addEventListener('touchend', handleEnd);
canvas.addEventListener('touchcancel', handleEnd);

window.addEventListener('resize', resize);
resize();

// –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞
requestAnimationFrame(loop);
</script>
</body>
</html>
