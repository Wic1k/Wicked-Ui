<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ö—Ä–æ–ª–∏–∫–∏ ‚Äî –ø–∞–¥–∞—é—Ç –∏ –æ—Å—Ç–∞—é—Ç—Å—è</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    touch-action: none;
  }
  canvas {
    position: absolute;
    top: 0; left: 0;
    display: block;
  }
  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    padding: 10px 16px;
    border-radius: 8px;
    color: #0f8;
    z-index: 10;
    pointer-events: none;
    font-family: Arial, sans-serif;
  }
  #counter {
    font-size: 2.8rem;
    font-weight: bold;
  }
  #fps {
    font-size: 1.3rem;
    margin-top: 4px;
  }
</style>
</head>
<body>

<div id="ui">
  <div>–ö–†–û–õ–ò–ö–û–í: <span id="counter">0</span></div>
  <div id="fps">FPS: ‚Äî</div>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha: false });
const counter = document.getElementById('counter');
const fpsEl = document.getElementById('fps');

let w, h;
let rabbits = [];
let isPressed = false;
let lastTime = performance.now();
let frameCount = 0;
let fpsTime = performance.now();
let fps = 0;
let lastSpawnTime = 0;

function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}

class Rabbit {
  constructor(x) {
    this.x = x;
    this.y = -40;
    this.speed = 14 + Math.random() * 10;
    this.size = 22 + Math.random() * 14;
    this.stopped = false;
  }

  update() {
    if (this.stopped) return;
    
    this.y += this.speed;
    
    if (this.y >= h - this.size * 0.6) {
      this.y = h - this.size * 0.6;
      this.stopped = true;
    }
  }

  draw(ctx) {
    ctx.font = Math.round(this.size) + 'px Arial';
    ctx.fillText('üê∞', this.x, this.y);
  }
}

function spawn(x, count = 10) {
  for(let i = 0; i < count; i++) {
    let offset = (Math.random() - 0.5) * 140;
    rabbits.push(new Rabbit(x + offset));
  }
  counter.textContent = rabbits.length;
}

function loop() {
  const now = performance.now();

  // –ï—Å–ª–∏ –∑–∞–∂–∞—Ç–æ - —Å–ø–∞—É–Ω–∏–º –∫–∞–∂–¥—ã–µ 50–º—Å
  if (isPressed && now - lastSpawnTime > 50) {
    const x = window.lastX !== undefined ? window.lastX : w / 2;
    spawn(x, 12);
    lastSpawnTime = now;
  }

  // –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤–º–µ—Å—Ç–æ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, w, h);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
  ctx.fillStyle = '#fff';
  for (let i = 0; i < rabbits.length; i++) {
    rabbits[i].update();
    rabbits[i].draw(ctx);
  }

  // FPS —Å—á—ë—Ç—á–∏–∫
  frameCount++;
  if (now - fpsTime >= 1000) {
    fps = frameCount;
    fpsEl.textContent = `FPS: ${fps} | –ö—Ä–æ–ª–∏–∫–æ–≤: ${rabbits.length}`;
    frameCount = 0;
    fpsTime = now;
  }

  requestAnimationFrame(loop);
}

function start(e) {
  e.preventDefault();
  isPressed = true;
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  window.lastX = x;
  lastSpawnTime = performance.now();
  spawn(x, 12);
}

function move(e) {
  e.preventDefault();
  if (!isPressed) return;
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  window.lastX = x;
}

function end() {
  isPressed = false;
}

canvas.addEventListener('mousedown', start);
canvas.addEventListener('mousemove', move);
canvas.addEventListener('mouseup', end);
canvas.addEventListener('mouseleave', end);

canvas.addEventListener('touchstart', start);
canvas.addEventListener('touchmove', move);
canvas.addEventListener('touchend', end);
canvas.addEventListener('touchcancel', end);

window.addEventListener('resize', resize);
resize();

requestAnimationFrame(loop);
</script>
</body>
</html>
